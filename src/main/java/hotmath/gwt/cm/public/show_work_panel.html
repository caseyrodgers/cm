<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
    <title>Catchup Math Show Work</title>
<style>
   #whiteboard {
       border: 1px solid red;
       position: absolute;
       top: 0;
       left: 0;
   }
   
   #whiteboard-bg {
       background-color: yellow;
       width: 330px;
       margin: 10px;
       margin-top:  40px;
       padding: 10px;

   }
</style>
</head>
<body>
<div id='whiteboard-object'>&nbsp;</div>
<div id='whiteboard-bg'>&nbsp;</div>
<script src='swfobject.js'></script>
	<script type="text/javascript">
		// <![CDATA[
                var fo = new SWFObject("whiteboard.swf", "whiteboard", "390", "300", "8.0.15", "#ffffff", true);
                // need this next line for local testing, it's optional if your swf is on the same domain as your html page
                fo.addParam("allowScriptAccess", "always");
                fo.addParam("wmode", "transparent");
                fo.write("whiteboard-object");
		// ]]>
	</script>


<script>
// setup hooks back to the GWT engine
// these are needed due to how Flash is 
// handled when loaded dynamically. The 
// main problem is the ExternalInterface
// from the flash component only works when
// loadeding during page load.  It breaks
// when loaded dynamically.

// called by flash component, we funnel
// it back to the parent JSNI method defined
// in ShowWorkPanel.class
function flashWhiteboardOut(jsonOut) {
    parent.flashWhiteboardOut(jsonOut);
}

// called when whiteboard is ready for
// commands.  Funnel it back to parent
// JSNI defined method in ShowWorkPanel.class
function flashWhiteboardIsReady() {
   // alert('flashWhiteboardIsReady in test');
   var fo = document.getElementById("whiteboard");
   parent.flashWhiteboardIsReady();   // call back to GWT JSNI
}

// called by GWT in ShowWorkPanel when reading
// data from server and requesting whiteboard
// to update itself.  
// The id is the unique flash id, the command+data
// is a single request for the whiteboard to do
// something. Such as 'draw', 'clear', or 'load'
// commandData, if used, is JSON.
function updateWhiteboard(id, command, commandData) {

   //  only works if single object on page
   // @TODO: get browser depend object
   var fo = document.getElementById("whiteboard");
   
   //alert(fo + ', ' + fo.name + ', ' + fo.updateWhiteboard);
   if(!fo) {
       alert('Could not find whiteboard flash object');
   }
   if(fo.updateWhiteboard) {
       // send an array of commands.  Each element in array
       // is a command and an array of data.  For example, one
       // 'draw', but a bunch of draw requests.
       fo.updateWhiteboard([['draw',[commandData]]]);
   }
   else {
      alert('could not found updateWhiteboard: ' + id);
   }
}

// register callback in the parent GWT to allow
// GWT to call back.
function setWhiteboardBackground(html) {
    //alert('setting background: ' + html);
    var wbg = document.getElementById('whiteboard-bg');
    wbg.innerHTML = html;
}
parent.setWhiteboardBackground = setWhiteboardBackground;
parent.updateWhiteboard = updateWhiteboard;
</script>
</body>
</html>
